{% extends "layout.html" %}

{% block content %}

<div class="container-fluid">

  <div class="alert alert-primary mt-2 mb-2" role="alert">
    {{title}}
  </div>

  <table class="table table-striped table-bordered table-hover sortable">
    <thead class="thead-light">
      <tr>
        <th>Name</th>
        <th>Package Version</th>
        <th>Upstream Version</th>
        <th>CVE</th>
        <th>Patches</th>
        <th>Developers</th>
        <th>URL</th>
      </tr>
    </thead>

    <tbody>
      {% for pkg in packages %}
      <tr>
        <!-- Name -->
        <td><a href="{{ url_for('package', name=pkg.name) }}">{{ pkg.name }}</a></td>

        <!-- Package Version / Upstream Version -->
        {% if pkg.latest_version == None %}
            {% if pkg.current_version | length > 20 %}
            <td class="table-secondary">{{ pkg.current_version[0:20] + ".." }}</td>
            {% else %}
            <td class="table-secondary">{{ pkg.current_version }}</td>
            {% endif %}
            <td class="table-secondary"><a href="https://release-monitoring.org/project/{{ pkg.latest_version_id }}">{{ pkg.latest_version }}</a></td>

        {% elif pkg.current_version == pkg.latest_version  %}
          {% if pkg.current_version | length > 20 %}
            <td class="table-success">{{ pkg.current_version[0:20] + ".." }}</td>
          {% else %}
            <td class="table-success">{{ pkg.current_version }}</td>
          {% endif %}
          <td class="table-success"><a href="https://release-monitoring.org/project/{{ pkg.latest_version_id }}">{{ pkg.latest_version }}</a></td>
        {% else %}
          {% if pkg.current_version | length > 20 %}
            <td class="table-danger">{{ pkg.current_version[0:20] + ".." }}</td>
          {% else %}
            <td class="table-danger">{{ pkg.current_version }}</td>
          {% endif %}
          <td class="table-danger"><a href="https://release-monitoring.org/project/{{ pkg.latest_version_id }}">{{ pkg.latest_version }}</a></td>
        {% endif %}

        <!-- CVE -->
        {% if pkg.cve_count == 0 %}
        <td class="table-success">0</td>
        {% else %}
        <td class="table-danger"><a href="{{ url_for('package', name=pkg.name, _anchor='cves') }}">{{ pkg.cve_count }}</a></td>
        {% endif %}

        <!-- Patches -->
        {% if pkg['patch_count'] == 0 %}
        <td class="table-success">0</td>
        {% else %}
        <td class="table-warning"><a href="{{ url_for('package', name=pkg.name, _anchor='patches') }}">{{ pkg.patch_count }}</a></td>
        {% endif %}

        <!-- Developers -->
        {% if pkg.developer_count == 0 %}
        <td class="table-secondary">{{ pkg.developer_count }}</td>
        {% else %}
        <td class="table-success">{{ pkg.developer_count }}</td>
        {% endif %}

        <!-- URL -->
        {% if pkg.url == None %}
        <td class="table-secondary"></td>
        {% else %}
        <td class="table-success"><a href="{{ pkg.url }}">URL</a></td>
        {% endif %}

      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
